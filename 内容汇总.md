# Bug修复
  
- 修复了骑乘状态的宠物对幻觉产生反应的问题。

- 修复了进入深坑中的机甲，弹出时手中的机甲武器没有正常移除的问题。

- 修复了安装在宠物上的包没有正确处理包中事先存在的物品的问题。

- 修复获得成就时的崩溃。

- 修复一个由于过期指针而导致的崩溃。

- 修复怪物攻击死亡NPC时的崩溃。

- 修复生成怪物时偶尔的崩溃。

- 修复被击退/传送的生物不会触发陷阱的问题。

- 修复npc只会换弹匣而不会装填弹匣的问题。

- 修复高级物品管理菜单无法按照特性搜索物品的问题。

- 修复了使用全部为腐坏的原料会制作出新鲜食物的问题。

- 修复了怪物会攻击玩家的幻觉的问题。

- 修复锡粉配方中存在的钢块副产品的问题。

- 修复攻击没有对玩家造成伤害但却施加扣除玩家生命值的腐蚀效果的问题。

- 修复了ASRG发电机双倍发电的问题。

- 修复每次进入游戏怪物的第一次特殊攻击的冷却时间在范围内随机的问题。

- 修复当尝试将物品放入宠物身上的包的时候没有考虑包所能容纳的最大长度的问题。


# 优化

- 优化了身边有大量物品时的制作速度。

- 缓存角色的辐射水平。

- 将"limb_scores"存储为map，而不是vector。

- 将“count_*_flag”替换为“has_*_flag”。

- 优化以及移除多余的代码——在vehicle.cpp。

- 重写 Effect type modifiers。

- 将“point sm_to_ms_copy(const point& p)”和“tripoint sm_to_ms_copy(const tripoint& p)”内联。

- 通过预先计算怪物的可访问区域来优化怪物的攻击性检查。

- 有关活跃物品缓存的优化。

- 为徒手的npc缓存武器值，以加快npc::regen_ai_cache()。

- 降低npc频繁进行EOC检查过程中的性能损耗。

- 缓存npc的死亡状态，降低死亡检查过程中的性能损耗。

- 通过仅在需要时分配submap数据来优化内存使用。

- 加快了traverse_vehicle_graph()，从而加快了当周围存在大量电器时的游戏速度。

- 对于Character::has_trait，使用find而不是count。

- 安卓端，handle_finger_input :避免多次计算delta_y的绝对值。

- 将cata_tiles::draw中的局部常量drawing_layers与drawing_layers_legacy作为private成员。

- ff::point_flood_fill_4_connected（用于自动驾驶和部分地形的生成）：使用phmap::flat_hash_set代替std::unordered_set

- Character::leak_items：std::vector->veque::veque

- Character::process_items：std::vector->veque::veque

- cata_tiles::draw：std::map->phmap::btree_map

- get_option/get_world_defaults：std::unordered_map -> phmap::flat_hash_map

- 安卓端：缓存了许多频繁调用的选项的值

- 安卓端：全局化了JNI操作相关的JNIEnv、jobject、jclass、jmethodID，避免频繁获取、销毁带来的开销

# 新增特性

- 在设置中的常规选项卡里添加了名为“骑乘状态可以上下楼”的选项。

- 可以命令npc制作物品。

- 重做柔道的被动加成，从摔倒中恢复体力。

- 当使用远距攻击的时候，如果攻击轨迹有友好的宠物或者npc，添加一个警告。

- 骑乘状态下，被骑乘的怪物可以对玩家的近战攻击的目标进行近战攻击。

- 让梯子类似于坡道一样工作，使得上下梯子的过程更加顺畅。

- 绘制低级z轴画面。

- 更酷的爆炸。

- 高空坠物会对命中的生物造成伤害。

- 直升机可以悬停。
  1. 首先给直升机安装 “可编程自动驾驶仪”。
  2. 飞起来之后，选择“交给自动驾驶仪来保持平稳”。
  3. 之后你可以自由的在直升机上活动。
  4. 重新获取控制权，只需要回到驾驶位置按“^”。
  5. 你可以将速度降为0，再移交控制权，也可以留有速度移交控制权，如果载具留有一定速度，会先在空中滑行一段时间。
  6. 悬停过程中，载具依然在耗费着燃料。

- 在宠物菜单添加了“查看状态”的选项。

- 增加了一件人类体型的宠物可用的废料护甲。

- 身为玩家宠物的怪物无法对身为玩家宠物的其他怪物使用"ZOMBIE_FUSE"。

- 允许怪物的特殊攻击"PARROT_AT_DANGER"将玩家和npc作为目标。

- 怪物的“SMASH”攻击不仅可以让目标产生水平位移，还有几率让被击飞的目标只纵向的穿越z轴，在此几率下，精英怪物发动联招，先将目标向上击飞，等目标落下后，再将目标向水平方向击飞。

- 使处在现实气泡中的怪物每天可以自然回复生命值。采用简单有效的方案，机器人之外的怪物每天自然回复最大生命值的百分之5的血量，至少回复1点血量。

- 部分怪物可以自主的装备武器。丧尸浩克、狂暴丧尸兽、飞行员丧尸、军装丧尸、士兵丧尸。他们偶尔会拿起附近的物品，之后偶尔也会将物品给丢下。

- 引入了怪物等级。怪物击杀敌人可以获取经验，每升1级，速度加5，最大等级为10级。“怪物的等级 * 5”可以作为怪物的近战伤害加成。可以在设置的常规选项卡下的“怪物的等级动态变化”选项设置为关。未来进行扩展。

- 平衡真菌在游戏中的强度。预想中，真菌应该成为综合实力中等或者稍弱的派系，但是如果玩家有意辅佐，便能迅速壮大。
  1. 如果是白天，FUNGUS_HAZE的成功几率为 1/75，其他时间为1/100。喷射范围由3降低到1。强度设定为2。
  2. 如果是白天，FUNGUS_BIG_BLOSSOM的成功几率为 1/75，其他时间为1/100，喷射范围由12降低到6，强度设定为2。


- 特效：添加粒子系统系统。在设置的“图形”选项卡下添加名为“启用粒子系统”的选项，目前是测试阶段。开启后，将在游戏的一些地方使用粒子系统。目前已在 毛毛雨、细雨、雨、雪 这三种天气上应用。目前默认为关。

- 在主菜单添加了“备份当前世界”的选项，执行过程中自动执行一次保存，之后会在“save”文件夹内生成以当前世界的名称加上"_备份"后缀的世界存档， 如果“save”文件夹内本来就有以当前世界的名称加上“_备份”后缀的世界存档，会首先删除此世界存档，之后再执行备份操作。

- 在主菜单，将"保存并退出"的功能替换为"退出到游戏开始界面”的功能。

- 死亡后，游戏不会再删除死亡角色的存档，会保留该角色上一次的存档。

- 死亡后，游戏不再生成玩家的尸体。

- 降低 敏捷速度加成mod 获取增益的最低敏捷标准。原本的敏捷速度加成mod，敏捷每超过12一点，增加两点速度。现在进行调整，调整到敏捷超过8即可获取增益。

- 可以一键显示/隐藏所有内容物，需要先打开有关的窗口，绑定上快捷键。

- 可以隐藏生化插件在玩家身上的外观。

- 自动备注收藏物品的功能的调整
  1. 自动备注收藏物品只备注种类，不备注数量。
  2. 每次玩家 拾取/放下/丢弃 收藏的物品，会同步更新备注上剩余的收藏物品的种类。
  3. 备注产生的位置以实行动作之后的物品所在的大地图位置为准，而不是玩家所在的  地图位置，这是因为玩家有可能刚好在两个大地图格的边界恰好将物品放到了另一个大地图格。
  4. 将收藏物品放入载具上不记录位置。

- 在主菜单添加“数据检索”选项，将在原版的调试功能所能展示的信息的基础上，来展示更多的信息，以提供数据检索服务，在功能分类上不属于调试。1. 怪物数据检索。目前复刻了原版在选中了调试菜单中的“生成怪物”后所展示的ui，并去除了生成怪物的功能，使其完全为数据检索而服务。

- 添加两个新的CBM到鲁比克的商品里，分别可以获得直升机驾驶和飞行器机械师这两个专长。

- 为游戏中的特殊NPC添加图片。目前已有图片的NPC：鲁比克、陈宛。

- 提高了难民中心的生成优先级。

- 部分物品可以连接电网充电。目前支持此特性的物品：笔记本电脑、MP3播放器、掌上游戏机、智能手机、电纸书。

- 添加了新的电器，运输器。可以用来运输物品和生物。目前可以在鲁比克那里买到。运输器可以跨z轴运行，并且可以承接从高处掉落的物品。

- 添加了新的电器，分拣器。可以根据设置的分拣规则，向四个方向输出物品。

- 添加了模块化的车载厨房和车载工坊。旧的车载厨房依然保留在了游戏当中。

- 可以在游戏的开始界面编辑世界模组。

- 在施法界面，如果法术信息太长，显示滚动条。

- 选取载入角色时，显示角色游玩时间。

- 当身边有多个npc时，进行对话，显示npc位置。

- npc可以使用车载武器。
  1. 在战斗指令里，让npc使用车载武器（默认情况下是使用的），之后让npc处在车载武器相应的位置即可。可以命令其前往指定位置，如果npc还是紧跟玩家，可以在npc到达指定位置后，再命令他坚守。
  2. 玩家无法使用npc正在使用的车载武器。
  3. 如果玩家设定了车载武器为自动瞄准，那么优先级比npc要高。
  4. 注意npc的视野。

- 新版区域显示：使用两种颜色来分别显示当前选定的区域和未选定的区域。可以通过“界面”选项卡下的“启用新版区域显示”选项开/关。

- 如果玩家在驾驶载具的时候使用/进食/消耗物品,显示警告。

- 窥视状态可以射击和远距攻击。在窥视界面按“F”。

- 更有倾向性的生成大地图。

- 添加海洋。

- 添加的模组：cata++、奥术。

- 允许远距攻击应用战技。

- 添加拼音搜索。可以在设置的“界面”选项卡里进行开/关。

- 添加树冠，以及可以爬树。

- 只有在空阔地带的丧尸会加入到尸潮中，尸潮更加倾向向着空阔的地带移动。 

- 在载具交互界面进行的行动也可以应用自动进食/自动饮用区域。

- npc可以拆解位于“拆解物品”区域中的载具上的物品。

- 增大现实气泡的范围，视野与远程攻击的最大范围提高到72

- 处在载具上的怪物的产物，例如粪便和蛋，优先放置到载具上

- 安卓端：可以推送指定的npc说的话。可以在设置中的“安卓”选项卡里进行开/关。

- 安卓端：添加扩展按键。可以在设置中的“安卓”选项卡里进行开关。

- 在“和他人交谈”菜单上加入一个选项可以命令npc前往指定位置，到达后，npc会再返回。

- 在施法界面，可以根据法术体系对法术进行分类，以及可以收藏法术。

- 在界面选项卡里，添加一个名为“派系态度以数值显示”的选项，开启时，在派系界面，派系态度将以数值的方式显示。默认为关。

- 在设置的“默认世界”/“当前世界”选项卡下添加名为“宏观种子生长周期比例系数”的选项。

- 在设置的“调试”选项卡下添加名为“不再弹出错误信息”的选项。

- 在设置的“界面”选项卡下添加名为“显示独立角色的图片”的选项。

- 在设置的“界面”选项卡下添加名为“显示生物血条”的选项。

- 在设置的“界面”选项卡下添加名为“显示玩家的剩余行动点”的选项。

- 可以命令npc前往大地图上的指定位置。这个位置需要玩家事先在大地图上按“W”选择目的地。“[交互]我有些事情想让你做”->“我们来谈谈营地的事情”->“请到这个地方”->“我指定的位置”。

- 安卓端：可以在设置的“安卓”选项卡里选择是否强制全屏，修改后需要重新启动。默认为强制全屏。

- 使用交易界面来和宠物交换物品。
 
# 其他修改

- 安卓版本启动时，不再弹出无障碍服务选项。

- “使用大地图贴图包”默认为 关 。
 
- “振动时长”的值调整为 0 。

- “虚拟手柄重复频率（中心）”的值调整为 50 。

- “虚拟手柄重复频率（偏离）的值调整为 50 。
 
- “虚拟手柄重复频率灵敏度的值调整为” 0.10 。

- “输入重复延时”的值调整为 250 。

- “自动保存”的值调整为 关 。

- 将"删除世界"和"重置世界"的位置靠后调整。

- 移除了设置中的“安卓”选项卡里的“自动添加物品菜单选项至快捷键”。它是一个过时且无效的设置，开启它还会使得物品栏的部分快捷键从画面上移除。

# 留档的特性

被标记为留档的特性在短期内将不会有所发展

- 添加丧尸主宰场景。对于身为丧尸主宰的玩家而言：（1）视野中的丧尸有1/100的概率自然成为玩家的宠物。（2）可以对身为丧尸的宠物执行“命令xxx在这里等待”和“命令xxx不要在这里继续等待”。(3) 可以对敌对的丧尸执行“支配”，如果敌对丧尸当前的生命值小于其最大生命值的百分之10(向下取整)，那么支配成功，否则失败。无论成功与否，“支配”消耗玩家100行动点。(4) 添加“治疗”，只能治疗丧尸，默认消耗1000耐力，治疗量为 10 + 丧尸主宰职业等级 * 10。（5）可以对敌对的丧尸执行“内部结构破坏”。伤害计算公式为：20 + 20 * 角色的丧尸主宰职业等级。（6）玩家可以将能够复活的尸体复活。（7）当玩家的丧尸主宰职业等级大于0的时候，在行动菜单添加三个命令，分别是“命令视野中的我方丧尸全部等待”、“结束视野中的我方全部丧尸的等待状态”、“融合可以复活的尸体”。“融合可以复活的尸体”可以将能够复活的30具尸体融合成一个放荡吞噬者。

- 大魔法模组: 丧尸圣诞猫可以被骑乘。

- 增加放荡吞噬者与融合特遣队的flag: 可以装备武器 + PET_MOUNTABLE。

- 部分怪物可以装备武器。玩家可以将手持的物品给怪物装备上，怪物会获得所装备武器的钝击伤害作为近战伤害的加成。未来进行扩展。可以装备武器的怪物: 丧尸、追猎者丧尸、飞行员丧尸、军装丧尸、士兵丧尸 、矿工丧尸、长臂丧尸、肥胖丧尸、健壮丧尸、丧尸浩克、放荡吞噬者、融合特遣队。

- 在行动菜单添加了“显示当前职业情况”的选项。目前只有玩家选择了丧尸主宰职业才会显示这个选项。未来进行扩展。

- 增加 派系威压 功能。目前可以与难民中心的商人进行对话，选择“派系威压（派系类型选项）”即可。
  1. 首先 威压 是一个相对高风险的选项。
它是派系类型选项，由玩家以一个派系领导者的身份对另一派系的领导者进行。威压之前，就应当准备足够的工作，因为威压进行过程中可操作性很小。
  1. 现在，设定难民中心的实际领导者是商人。同时，难民中心的其他派系是难民中心的子派系。游戏目前仅仅初步写好了商人及其派系的威压。
  2. 威压的规则很简单，流程为10个回合，要尽可能的在10个回合内让对方的心理压力值到达100，即为压制成功。
  3. 下面介绍三个选项。
    UP 可以是 键盘的方向键的UP，也可以是手机上滑。之后同理。
    — 普通的威压。这一选项，有一定的权重在于智力的比拼。此选项降低派系好感度。可以重复多次。
    — 展示宠物。这一选项在于展示宠物的战力，是一种相对温和的威压方式。目的是让其以点窥面。不降低派系好感度。只能使用一次。设定上，强大的宠物对于商路的护卫意义极大，可以有效减少人员的投入与损耗。此选项对商人有特效，但还是需要准备足够多的强大宠物。同时，如果武力值相差极大，也会随机触发坏事件。只能使用一次。
    — 以武力进行极限威压。真正的高风险选项。实行前需要仔细衡量一下双方的武力值，如果玩家所能搬出的总武力太少，商人大概率会决定消灭玩家。此选项降低派系好感度。只能使用一次。
  4. 威压成功后，派系的征服度会立即到达100，之后会随机递减。在降低到50以下后，派系就会出现反抗。
反抗手段目前只有一种，即派出刺客。
  1. 削弱对方派系武力的方式：想办法去除对方派系的人员。
  2. 威压流程的资源准备：尽可能将我方足够多的npc，宠物放在同一个现实气泡内。
  3. 威压成功后的特权：以30天为一次期限，免费拿取一次商人货物。

- 派系访问 v0.17 。
在设置里的常规选项卡添加一个名为“派系访问”的选项。
在开启的情况下，如果“自由商会”对你的好感度不至于太低，并且玩家必须处于营地的范围，那么间隔10天半左右的时间，会在你的附近生成所属派系的交易人员，你与他们只能进行交易活动。游戏新添加了一个区域为“交易区域”，你可以先在区域管理上创建一片交易区域，之后生成的交易人员会在指定的交易区域等你交易，他们会等待10分钟，之后会自行离开。
如果你没有创建一片交易区域，那么交易人员会以你当前位置为目标。推荐创建一片交易区域。在派系界面，会显示距离下一次交易员访问的回合数，以及玩家在不在营地的范围。
如果玩家在营地附近，但是周围有敌对的怪物存在，那么玩家不会通过自由商会的安全评估，最终不会有交易员到达。自由商会对你的好感度越高，来的交易员也越多。此选项目前默认为关。